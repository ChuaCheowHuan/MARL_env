(venv) Duality0:MM_env hadron0$ python test_MM_env.py
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 3, 'price': Decimal('2'), 'trade_id': 0, 'timestamp': 1, 'order_id': 1}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 4, 'price': Decimal('5'), 'trade_id': 1, 'timestamp': 2, 'order_id': 2}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 5, 'price': Decimal('8'), 'trade_id': 2, 'timestamp': 3, 'order_id': 3}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 6, 'price': Decimal('11'), 'trade_id': 3, 'timestamp': 4, 'order_id': 4}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 3, 'price': Decimal('3'), 'trade_id': 0, 'timestamp': 5, 'order_id': 5}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 4, 'price': Decimal('6'), 'trade_id': 1, 'timestamp': 6, 'order_id': 6}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 5, 'price': Decimal('9'), 'trade_id': 2, 'timestamp': 7, 'order_id': 7}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 6, 'price': Decimal('12'), 'trade_id': 3, 'timestamp': 8, 'order_id': 8}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 3, 'price': Decimal('4'), 'trade_id': 0, 'timestamp': 9, 'order_id': 9}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 4, 'price': Decimal('7'), 'trade_id': 1, 'timestamp': 10, 'order_id': 10}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 5, 'price': Decimal('10'), 'trade_id': 2, 'timestamp': 11, 'order_id': 11}
order_in_book: {'type': 'limit', 'side': 'bid', 'quantity': 6, 'price': Decimal('13'), 'trade_id': 3, 'timestamp': 12, 'order_id': 12}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 3, 'price': Decimal('14'), 'trade_id': 0, 'timestamp': 13, 'order_id': 13}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 4, 'price': Decimal('17'), 'trade_id': 1, 'timestamp': 14, 'order_id': 14}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 5, 'price': Decimal('20'), 'trade_id': 2, 'timestamp': 15, 'order_id': 15}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 6, 'price': Decimal('23'), 'trade_id': 3, 'timestamp': 16, 'order_id': 16}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 3, 'price': Decimal('15'), 'trade_id': 0, 'timestamp': 17, 'order_id': 17}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 4, 'price': Decimal('18'), 'trade_id': 1, 'timestamp': 18, 'order_id': 18}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 5, 'price': Decimal('21'), 'trade_id': 2, 'timestamp': 19, 'order_id': 19}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 6, 'price': Decimal('24'), 'trade_id': 3, 'timestamp': 20, 'order_id': 20}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 3, 'price': Decimal('16'), 'trade_id': 0, 'timestamp': 21, 'order_id': 21}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 4, 'price': Decimal('19'), 'trade_id': 1, 'timestamp': 22, 'order_id': 22}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 5, 'price': Decimal('22'), 'trade_id': 2, 'timestamp': 23, 'order_id': 23}
order_in_book: {'type': 'limit', 'side': 'ask', 'quantity': 6, 'price': Decimal('25'), 'trade_id': 3, 'timestamp': 24, 'order_id': 24}
expected_result_0: (10000, 0, 0, 10000, 0)
result_0: (Decimal('9838'), Decimal('162'), 0, Decimal('10000'), 0)
expected_result_1: (10000, 0, 0, 10000, 0)
result_1: (Decimal('9712'), Decimal('288'), 0, Decimal('10000'), 0)
expected_result_2: (10000, 0, 0, 10000, 0)
result_2: (Decimal('9550'), Decimal('450'), 0, Decimal('10000'), 0)
expected_result_3: (10000, 0, 0, 10000, 0)
result_3: (Decimal('9352'), Decimal('648'), 0, Decimal('10000'), 0)

LOB:
 ***Bids***
6@13/3 - 12
6@12/3 - 8
6@11/3 - 4
5@10/2 - 11
5@9/2 - 7
5@8/2 - 3
4@7/1 - 10
4@6/1 - 6
4@5/1 - 2
3@4/0 - 9
3@3/0 - 5
3@2/0 - 1

***Asks***
3@14/0 - 13
3@15/0 - 17
3@16/0 - 21
4@17/1 - 14
4@18/1 - 18
4@19/1 - 22
5@20/2 - 15
5@21/2 - 19
5@22/2 - 23
6@23/3 - 16
6@24/3 - 20
6@25/3 - 24

***tape***
Q @ $ (t) c/i side

LOB_STATE:
 (array([6., 6., 6., 5., 5., 5., 4., 4., 4., 3.]), array([13., 12., 11., 10.,  9.,  8.,  7.,  6.,  5.,  4.]), array([-3., -3., -4., -4., -5., -5., -6., -6.,  0.,  0.]), array([-14., -15., -17., -18., -20., -21., -23., -24.,   0.,   0.]))

LOB_STATE_NEXT:
 (array([6., 6., 6., 5., 5., 5., 4., 4., 4., 3.]), array([13., 12., 11., 10.,  9.,  8.,  7.,  6.,  5.,  4.]), array([-3., -3., -3., -4., -4., -4., -5., -5., -5., -6.]), array([-14., -15., -16., -17., -18., -19., -20., -21., -22., -23.]))

state_diff:
 [array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]), array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]), array([ 0.,  0.,  1.,  0.,  1.,  1.,  1.,  1., -5., -6.]), array([  0.,   0.,   1.,   1.,   2.,   2.,   3.,   3., -22., -23.])]

rewards:
 [{'ID': 0, 'reward': Decimal('0')}, {'ID': 1, 'reward': Decimal('0')}, {'ID': 2, 'reward': Decimal('0')}, {'ID': 3, 'reward': Decimal('0')}]

ID: 0
cash: 9838
cash_on_hold: 162
position_val: 0
nav: 10000
net_position: 0

ID: 1
cash: 9712
cash_on_hold: 288
position_val: 0
nav: 10000
net_position: 0

ID: 2
cash: 9550
cash_on_hold: 450
position_val: 0
nav: 10000
net_position: 0

ID: 3
cash: 9352
cash_on_hold: 648
position_val: 0
nav: 10000
net_position: 0

i: 0
trade: {'timestamp': 25, 'price': Decimal('14'), 'quantity': Decimal('3'), 'time': 25, 'counter_party': {'ID': 0, 'side': 'ask', 'order_id': 13, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
init_party: 0
cash 9880
cash_on_hold 120
position_val 0
nav 10000
net_position 0
i: 1
trade: {'timestamp': 25, 'price': Decimal('15'), 'quantity': Decimal('3'), 'time': 25, 'counter_party': {'ID': 0, 'side': 'ask', 'order_id': 17, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
init_party: 0
cash 9925
cash_on_hold 75
position_val 0
nav 10000
net_position 0
i: 2
trade: {'timestamp': 25, 'price': Decimal('16'), 'quantity': Decimal('3'), 'time': 25, 'counter_party': {'ID': 0, 'side': 'ask', 'order_id': 21, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
init_party: 0
cash 9973
cash_on_hold 27
position_val 0
nav 10000
net_position 0
i: 3
trade: {'timestamp': 25, 'price': Decimal('17'), 'quantity': Decimal('4'), 'time': 25, 'counter_party': {'ID': 1, 'side': 'ask', 'order_id': 14, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 1
cash 9712
cash_on_hold 220
position_val 68
nav 10000
net_position -4
init_party: 0
cash 9905
cash_on_hold 27
position_val 68
nav 10000
net_position 4
i: 4
trade: {'timestamp': 25, 'price': Decimal('18'), 'quantity': Decimal('4'), 'time': 25, 'counter_party': {'ID': 1, 'side': 'ask', 'order_id': 18, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 1
cash 9712
cash_on_hold 220
position_val 136
nav 10000
net_position -8
init_party: 0
cash 9833
cash_on_hold 27
position_val 140
nav 10000
net_position 8
i: 5
trade: {'timestamp': 25, 'price': Decimal('19'), 'quantity': Decimal('4'), 'time': 25, 'counter_party': {'ID': 1, 'side': 'ask', 'order_id': 22, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 1
cash 9712
cash_on_hold 220
position_val 196
nav 10000
net_position -12
init_party: 0
cash 9757
cash_on_hold 27
position_val 216
nav 10000
net_position 12
i: 6
trade: {'timestamp': 25, 'price': Decimal('20'), 'quantity': Decimal('5'), 'time': 25, 'counter_party': {'ID': 2, 'side': 'ask', 'order_id': 15, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 2
cash 9550
cash_on_hold 350
position_val 100
nav 10000
net_position -5
init_party: 0
cash 9657
cash_on_hold 27
position_val 316
nav 10000
net_position 17
i: 7
trade: {'timestamp': 25, 'price': Decimal('21'), 'quantity': Decimal('5'), 'time': 25, 'counter_party': {'ID': 2, 'side': 'ask', 'order_id': 19, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 2
cash 9550
cash_on_hold 350
position_val 200
nav 10000
net_position -10
init_party: 0
cash 9552
cash_on_hold 27
position_val 421
nav 10000
net_position 22
i: 8
trade: {'timestamp': 25, 'price': Decimal('22'), 'quantity': Decimal('5'), 'time': 25, 'counter_party': {'ID': 2, 'side': 'ask', 'order_id': 23, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 2
cash 9550
cash_on_hold 350
position_val 290
nav 10000
net_position -15
init_party: 0
cash 9442
cash_on_hold 27
position_val 531
nav 10000
net_position 27
i: 9
trade: {'timestamp': 25, 'price': Decimal('23'), 'quantity': Decimal('6'), 'time': 25, 'counter_party': {'ID': 3, 'side': 'ask', 'order_id': 16, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 3
cash 9352
cash_on_hold 510
position_val 138
nav 10000
net_position -6
init_party: 0
cash 9304
cash_on_hold 27
position_val 669
nav 10000
net_position 33
i: 10
trade: {'timestamp': 25, 'price': Decimal('24'), 'quantity': Decimal('6'), 'time': 25, 'counter_party': {'ID': 3, 'side': 'ask', 'order_id': 20, 'new_book_quantity': None}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 3
cash 9352
cash_on_hold 510
position_val 276
nav 10000
net_position -12
init_party: 0
cash 9160
cash_on_hold 27
position_val 813
nav 10000
net_position 39
i: 11
trade: {'timestamp': 25, 'price': Decimal('25'), 'quantity': Decimal('2'), 'time': 25, 'counter_party': {'ID': 3, 'side': 'ask', 'order_id': 24, 'new_book_quantity': Decimal('4')}, 'init_party': {'ID': 0, 'side': 'bid', 'order_id': None, 'new_book_quantity': None}}
counter_party: 3
cash 9352
cash_on_hold 510
position_val 302
nav 10000
net_position -14
init_party: 0
cash 9110
cash_on_hold 27
position_val 863
nav 10000
net_position 41
side == None
side == None
side == None
expected_result_0: (10000, 0, 0, 10000, 0)
result_0: (Decimal('9110'), Decimal('27'), Decimal('863'), Decimal('10000'), Decimal('41'))
expected_result_1: (10000, 0, 0, 10000, 0)
result_1: (Decimal('9712'), Decimal('220'), Decimal('196'), Decimal('10128'), Decimal('-12'))
expected_result_2: (10000, 0, 0, 10000, 0)
result_2: (Decimal('9550'), Decimal('350'), Decimal('290'), Decimal('10190'), Decimal('-15'))
expected_result_3: (10000, 0, 0, 10000, 0)
result_3: (Decimal('9352'), Decimal('510'), Decimal('302'), Decimal('10164'), Decimal('-14'))

LOB:
 ***Bids***
6@13/3 - 12
6@12/3 - 8
6@11/3 - 4
5@10/2 - 11
5@9/2 - 7
5@8/2 - 3
4@7/1 - 10
4@6/1 - 6
4@5/1 - 2
3@4/0 - 9
3@3/0 - 5
3@2/0 - 1

***Asks***
4@25/3 - 24

***tape***
Q @ $ (t) c/i side
2 @ 25 (25) 3/0 bid
6 @ 24 (25) 3/0 bid
6 @ 23 (25) 3/0 bid
5 @ 22 (25) 2/0 bid
5 @ 21 (25) 2/0 bid
5 @ 20 (25) 2/0 bid
4 @ 19 (25) 1/0 bid
4 @ 18 (25) 1/0 bid
4 @ 17 (25) 1/0 bid
3 @ 16 (25) 0/0 bid
3 @ 15 (25) 0/0 bid
3 @ 14 (25) 0/0 bid

LOB_STATE:
 (array([6., 6., 6., 5., 5., 5., 4., 4., 4., 3.]), array([13., 12., 11., 10.,  9.,  8.,  7.,  6.,  5.,  4.]), array([-3., -3., -3., -4., -4., -4., -5., -5., -5., -6.]), array([-14., -15., -16., -17., -18., -19., -20., -21., -22., -23.]))

LOB_STATE_NEXT:
 (array([6., 6., 6., 5., 5., 5., 4., 4., 4., 3.]), array([13., 12., 11., 10.,  9.,  8.,  7.,  6.,  5.,  4.]), array([-4.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.]), array([-25.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.,   0.]))

state_diff:
 [array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]), array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]), array([-1.,  3.,  3.,  4.,  4.,  4.,  5.,  5.,  5.,  6.]), array([-11.,  15.,  16.,  17.,  18.,  19.,  20.,  21.,  22.,  23.])]

rewards:
 [{'ID': 0, 'reward': Decimal('0')}, {'ID': 1, 'reward': Decimal('128')}, {'ID': 2, 'reward': Decimal('190')}, {'ID': 3, 'reward': Decimal('164')}]

ID: 0
cash: 9110
cash_on_hold: 27
position_val: 863
nav: 10000
net_position: 41

ID: 1
cash: 9712
cash_on_hold: 220
position_val: 196
nav: 10128
net_position: -12

ID: 2
cash: 9550
cash_on_hold: 350
position_val: 290
nav: 10190
net_position: -15

ID: 3
cash: 9352
cash_on_hold: 510
position_val: 302
nav: 10164
net_position: -14

(venv) Duality0:MM_env hadron0$
